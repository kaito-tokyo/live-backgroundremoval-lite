---
import { joinURL, withTrailingSlash } from "ufo";

import Layout from "../layouts/Layout.astro";
import { GITHUB_URL, PRODUCTION_BASE_URL } from "../lib/info.js";
import {
  SYSTEM_WARNING_MESSAGE,
  SYSTEM_WARNING_BUTTON_TEXT,
  INITIAL_INPUT_PLACEHOLDER,
} from "../components/LBRLBuddy.js";

const { BASE_URL } = import.meta.env;
---

<Layout
  lang="en"
  title="Live Background Removal Lite Buddy - Ask Anything AI Chatbot"
  additionalCspConnectSrc=" https://huggingface.co/mlc-ai/ https://raw.githubusercontent.com/mlc-ai/ https://cas-bridge.xethub.hf.co/"
  additionalCspScriptSrc=" 'wasm-unsafe-eval'"
  trustedTypes={["lit-html"]}
>
  <Fragment slot="head-info">
    <meta
      name="description"
      content="Get instant help for Live Background Removal Lite securely. This experimental AI chatbot runs 100% locally in your browser‚Äîno data is sent to servers."
    />
    <link
      rel="canonical"
      href={withTrailingSlash(joinURL(PRODUCTION_BASE_URL, "ask-anything"))}
    />
  </Fragment>

  <main class="white-box">
    <lbrl-buddy>
      <div class="chat-container">
        <div class="message-list">
          <div class="initial-warning">
            <h2>System Warning</h2>
            <p>{SYSTEM_WARNING_MESSAGE}</p>
            <button class="agree-button" disabled>
              {SYSTEM_WARNING_BUTTON_TEXT}
            </button>
          </div>
        </div>
        <form>
          <input type="text" placeholder={INITIAL_INPUT_PLACEHOLDER} disabled />
          <button type="submit" disabled>Waiting</button>
        </form>
      </div>
    </lbrl-buddy>

    <div class="model-attribution">
      Built with <span>Llama 3.2</span>
    </div>
    <div class="disclaimer-note">
      <p>
        <strong>üî¨ Experimental Notice:</strong> This is an experimental feature and
        may experience unexpected behavior or changes.
      </p>
      <p>
        <strong>üîí Privacy Notice:</strong> This chat operates entirely within your
        local machine (browser). No data, messages, or sensitive information is ever
        sent to external servers or third parties.
      </p>
      <p>
        <strong>‚ö†Ô∏è Accuracy Warning:</strong> This chatbot may occasionally display
        inaccurate or outdated information. Always verify critical details presented
        in the response.
      </p>
    </div>

    <nav class="page-nav" aria-label="Page navigation">
      <ul>
        <li>
          <a href={withTrailingSlash(BASE_URL)}>Back to Top</a>
        </li>
        <li>
          <a
            href={withTrailingSlash(GITHUB_URL)}
            target="_blank"
            rel="noopener noreferrer">GitHub Repository</a
          >
        </li>
      </ul>
    </nav>
  </main>

  <Fragment slot="body-bottom">
    <script>
      import "../components/LBRLBuddy.js";
    </script>
  </Fragment>
</Layout>

<style is:global>
  lbrl-buddy:not(:defined) {
    display: block;
    box-sizing: border-box;
    --border: 1px solid #ccc;
    --background-color: #fff;
    --border-radius: 8px;
    --box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .chat-container {
    display: flex;
    flex-direction: column;
    height: 80vh;
    height: 80dvh;
    border: var(--border);
    border-radius: var(--border-radius);
    overflow: hidden;
    width: 100%;
    background-color: var(--background-color);

    .message-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
      flex-grow: 1;
      overflow-y: auto;
      padding: 15px;
      scroll-behavior: auto;
    }

    button {
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: opacity 0.2s;
    }

    button[type="submit"] {
      background-color: var(--primary-color);
      color: white;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    form {
      display: flex;
      gap: 10px;
      padding: 10px;
      border-top: var(--border);
      background-color: #fff;
    }

    input[type="text"] {
      flex-grow: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      outline: none;
      font-size: 16px;
    }

    input[type="text"]:focus {
      border-color: var(--primary-color);
    }

    .initial-warning {
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow-wrap: anywhere;
      padding: 15px;
      background-color: #fff3cd;
      color: #856404;
      margin-bottom: 10px;
    }

    .initial-warning h2 {
      font-size: 1rem;
      font-weight: bold;
      margin-top: 0;
    }

    .agree-button {
      background-color: #28a745;
      color: white;
      width: 100%;
      margin-top: 10px;
    }
  }

  .model-attribution {
    font-style: italic;
    text-align: center;
    margin: 1.5rem auto 0.5rem;
    font-weight: 700;
    font-size: 1.1rem;
    letter-spacing: -0.01em;
    color: #4b5563;
  }

  .model-attribution span {
    background: linear-gradient(135deg, #0068e1 0%, #a745ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    display: inline-block;
    padding-right: 0.2em;
  }

  .disclaimer-note {
    max-width: 600px;
    margin: 15px auto 0 auto;
    padding: 10px 15px;
    font-size: 0.85em;
    color: #555;
    background-color: #fffde7;
    border: 1px solid #f0e68c;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .disclaimer-note p {
    margin: 5px 0;
  }

  .disclaimer-note strong {
    font-weight: bold;
    color: #333;
  }
</style>
